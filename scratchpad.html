<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: auto;
  position: relative;
  width: 960px;
}

text {
  font: 10px sans-serif;
}

</style>
<form>
  <label><input type="radio" name="dataset" value="0" checked>2009</label>
  <label><input type="radio" name="dataset" value="1">2010</label>
  <label><input type="radio" name="dataset" value="2">2011</label>
  <label><input type="radio" name="dataset" value="3">2012</label>
</form>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

"use strict";
/*global d3*/

var width = 400,
    height = 400,
    radius = Math.min(width, height) / 2,
    data = [
      {"Year":"2009", "series":"Maserati", "Thousands Sold":"0"},
      {"Year":"2009", "series":"Mazda", "Thousands Sold":"2941"},
      {"Year":"2009", "series":"Mercedes", "Thousands Sold":"4303"},
      {"Year":"2009", "series":"Mini", "Thousands Sold":"354"},
      {"Year":"2009", "series":"Mitsubishi", "Thousands Sold":"5814"},
      {"Year":"2010", "series":"Maserati", "Thousands Sold":"5"},
      {"Year":"2010", "series":"Mazda", "Thousands Sold":"2905"},
      {"Year":"2010", "series":"Mercedes", "Thousands Sold":"2867"},
      {"Year":"2010", "series":"Mini", "Thousands Sold":"412"},
      {"Year":"2010", "series":"Mitsubishi", "Thousands Sold":"5284"},
      {"Year":"2011", "series":"Maserati", "Thousands Sold":"4"},
      {"Year":"2011", "series":"Mazda", "Thousands Sold":"2517"},
      {"Year":"2011", "series":"Mercedes", "Thousands Sold":"4822"},
      {"Year":"2011", "series":"Mini", "Thousands Sold":"552"},
      {"Year":"2011", "series":"Mitsubishi", "Thousands Sold":"6127"},
      {"Year":"2012", "series":"Maserati", "Thousands Sold":"2"},
      {"Year":"2012", "series":"Mazda", "Thousands Sold":"2422"},
      {"Year":"2012", "series":"Mercedes", "Thousands Sold":"5399"},
      {"Year":"2012", "series":"Mini", "Thousands Sold":"776"},
      {"Year":"2012", "series":"Mitsubishi", "Thousands Sold":"4151"}
    ];

var nested = d3.nest()
  .key(function(d) { return d["Year"]; })
  .entries(data);

var color = d3.scale.category20c();

var pie = d3.layout.pie()
    .value(function(d) { return d["Thousands Sold"]; })
    .sort(null);

var arc = d3.svg.arc()
    .innerRadius(radius - 100)
    .outerRadius(radius - 20);

// Make pie chart svg
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

// Make group to hold slice path and label
var slice_group = svg.datum(nested[0].values).selectAll("path")
  .data(pie)
  .enter()
    .append("g");

// This is the actual slice path
var slice_path = slice_group.append("path")
  .attr("fill", function(d, i) { return color(i); })
  .attr("d", arc)
  .each(function(d) { this._current = d; }); // store the initial angles

// Make group to hold labels
var label_group = slice_group.append("g")
  .attr("transform", function(d) {
    var c = arc.centroid(d);
    return "translate(" + c[0] * 1.5 +"," + c[1] * 1.5 + ")";
  });

var line_1 = label_group.append("text") // First line
  .text(function(d) { return d.data.series; })
  .attr("text-anchor", "middle");

var line_2 = label_group.append("text") // Second line
  .text(function(d) { return d.data["Thousands Sold"]; })
  .attr("dy", "1em")
  .attr("text-anchor", "middle");

// Make dataset selector
var selector = d3.select("body").append("form").selectAll("label")
  .data(nested)
  .enter()
    .append("label")
    .html(function (d, i) {
      var checked = (i = 0) ? "checked" : "";
      return "<input type='radio' name='dataset' value='" + i + "'" + checked + ">" + d.key;
    });

// Switch data
d3.selectAll("input")
  .on("change", change);

function change() {
  var value = this.value;
  svg.datum(nested[value].values);

  slice_path.data(pie) // compute the new angles
    .transition().duration(750).attrTween("d", arcTween); // redraw the arcs

  label_group.data(pie)
    .transition().duration(750)
    .attr("transform", function(d) {
      var c = arc.centroid(d);
      return "translate(" + c[0] * 1.5 +"," + c[1] * 1.5 + ")";
    });

  line_1.data(pie)
    .text(function(d) { return d.data["series"]; });

  line_2.data(pie)
    .text(function(d) { return d.data["Thousands Sold"]; });


}

// Store the displayed angles in _current.
// Then, interpolate from _current to the new angles.
// During the transition, _current is updated in-place by d3.interpolate.
function arcTween(a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return arc(i(t));
  };
}

</script>